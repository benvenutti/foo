language: cpp

matrix:
  include:
    # -----------------------------------------------------------------------------------
    # osx gcc-6

    - os: osx
      osx_image: xcode10
      env: MATRIX_EVAL="brew install gcc@6 && CC=gcc-6 && CXX=g++-6" BUILD_TYPE=Release

    - os: osx
      osx_image: xcode10
      env: MATRIX_EVAL="brew install gcc@6 && CC=gcc-6 && CXX=g++-6" BUILD_TYPE=Debug

    # -----------------------------------------------------------------------------------
    # linux gcc-6 with coverage

    - os: linux
      dist: trusty
      addons: &gcc6 { apt: { packages: [g++-6], sources: [ubuntu-toolchain-r-test] } }
      env: MATRIX_EVAL="CC=gcc-6 && CXX=g++-6" BUILD_TYPE=Release

    - os: linux
      dist: trusty
      addons: { apt: { packages: [g++-6, lcov], sources: [ubuntu-toolchain-r-test] } }
      env: MATRIX_EVAL="CC=gcc-6 && CXX=g++-6" BUILD_TYPE=Coverage GCOV=gcov-6

    # -----------------------------------------------------------------------------------
    # linux gcc-7

    - os: linux
      dist: trusty
      addons: &gcc7 { apt: { packages: [g++-7], sources: [ubuntu-toolchain-r-test] } }
      env: MATRIX_EVAL="CC=gcc-7 && CXX=g++-7" BUILD_TYPE=Release

    - os: linux
      dist: trusty
      addons: *gcc7
      env: MATRIX_EVAL="CC=gcc-7 && CXX=g++-7" BUILD_TYPE=Debug

    # -----------------------------------------------------------------------------------
    # linux gcc-8

    - os: linux
      dist: trusty
      addons: &gcc8 { apt: { packages: [g++-8], sources: [ubuntu-toolchain-r-test] } }
      env: MATRIX_EVAL="CC=gcc-8 && CXX=g++-8" BUILD_TYPE=Release

    - os: linux
      dist: trusty
      addons: *gcc8
      env: MATRIX_EVAL="CC=gcc-8 && CXX=g++-8" BUILD_TYPE=Debug

    # -----------------------------------------------------------------------------------
    # linux clang-4

    - os: linux
      dist: trusty
      addons: &clang4 { apt: {
        packages: [clang-4.0, libstdc++-6-dev] ,
        sources: [ubuntu-toolchain-r-test, llvm-toolchain-trusty-4.0] } }
      env: MATRIX_EVAL="CC=clang-4.0 && CXX=clang++-4.0" BUILD_TYPE=Release

    - os: linux
      dist: trusty
      addons: *clang4
      env: MATRIX_EVAL="CC=clang-4.0 && CXX=clang++-4.0" BUILD_TYPE=Debug

    # -----------------------------------------------------------------------------------
    # linux clang-5

    - os: linux
      dist: trusty
      addons: &clang5 { apt: {
        packages: [clang-5.0, libstdc++-6-dev] ,
        sources: [ubuntu-toolchain-r-test, llvm-toolchain-trusty-5.0] } }
      env: MATRIX_EVAL="CC=clang-5.0 && CXX=clang++-5.0" BUILD_TYPE=Release

    - os: linux
      dist: trusty
      addons: *clang5
      env: MATRIX_EVAL="CC=clang-5.0 && CXX=clang++-5.0" BUILD_TYPE=Debug

    # -----------------------------------------------------------------------------------
    # linux clang-6

    - os: linux
      dist: trusty
      addons: &clang6 { apt: {
        packages: [clang-6.0, libstdc++-6-dev] ,
        sources: [ubuntu-toolchain-r-test, llvm-toolchain-trusty-6.0] } }
      env: MATRIX_EVAL="CC=clang-6.0 && CXX=clang++-6.0" BUILD_TYPE=Release

    - os: linux
      dist: trusty
      addons: *clang6
      env: MATRIX_EVAL="CC=clang-6.0 && CXX=clang++-6.0" BUILD_TYPE=Debug

before_install:
  - eval "${MATRIX_EVAL}"

script:
  - mkdir build && cd build
  - cmake -DCMAKE_BUILD_TYPE=$BUILD_TYPE ..
  - cmake --build .
  - ctest -VV .

after_success:
  - ${TRAVIS_BUILD_DIR}/ci/travis-coverage.sh

notifications:
  email: false
